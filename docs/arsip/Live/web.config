<?xml version="1.0" encoding="UTF-8"?>
<configuration>
    <system.webServer>
        <rewrite>
            <rules>
                <!-- Redirect HTTP to HTTPS -->
                <rule name="Redirect HTTP to HTTPS" stopProcessing="true">
                    <match url="(.*)" />
                    <conditions>
                        <add input="{HTTPS}" pattern="^OFF$" />
                        <add input="{HTTP_HOST}" pattern="^live\.refast\.id$" />
                    </conditions>
                    <action type="Redirect" url="https://live.refast.id/{R:1}" redirectType="Permanent" />
                </rule>
                
                <!-- Reverse Proxy to localhost:2004 -->
                <rule name="ReverseProxyInboundRule1" stopProcessing="true">
                    <match url="(.*)" />
                    <action type="Rewrite" url="http://localhost:2004/{R:1}" />
                    <serverVariables>
                        <set name="HTTP_X_FORWARDED_PROTO" value="{HTTPS}" />
                        <set name="HTTP_X_FORWARDED_HOST" value="{HTTP_HOST}" />
                        <set name="HTTP_X_FORWARDED_FOR" value="{REMOTE_ADDR}" />
                        <set name="HTTP_X_REAL_IP" value="{REMOTE_ADDR}" />
                    </serverVariables>
                </rule>
            </rules>
            <allowedServerVariables>
                <add name="HTTP_X_FORWARDED_PROTO" />
                <add name="HTTP_X_FORWARDED_HOST" />
                <add name="HTTP_X_FORWARDED_FOR" />
                <add name="HTTP_X_REAL_IP" />
            </allowedServerVariables>
        </rewrite>
        <httpProtocol>
            <customHeaders>
                <remove name="X-Powered-By" />
            </customHeaders>
        </httpProtocol>
        <!-- Custom Error Pages Configuration -->
        <httpErrors errorMode="Custom" existingResponse="Replace">
          <!-- 400 Bad Request -->
          <remove statusCode="400" subStatusCode="-1" />
          <error statusCode="400" path="../../errors/400.html" responseMode="ExecuteURL" />
          
          <!-- 401 Unauthorized -->
          <remove statusCode="401" subStatusCode="-1" />
          <error statusCode="401" path="../../errors/401.html" responseMode="ExecuteURL" />
          
          <!-- 403 Forbidden -->
          <remove statusCode="403" subStatusCode="-1" />
          <error statusCode="403" path="../../errors/403.html" responseMode="ExecuteURL" />
          
          <!-- 404 Not Found -->
          <remove statusCode="404" subStatusCode="-1" />
          <error statusCode="404" path="../../errors/404.html" responseMode="ExecuteURL" />
          
          <!-- 500 Internal Server Error -->
          <remove statusCode="500" subStatusCode="-1" />
          <error statusCode="500" path="../../errors/500.html" responseMode="Redirect" />
          
          <!-- 502 Bad Gateway -->
          <remove statusCode="502" subStatusCode="-1" />
          <error statusCode="502" path="../../errors/502.html" responseMode="ExecuteURL" />
          
          <!-- 503 Service Unavailable -->
          <remove statusCode="503" subStatusCode="-1" />
          <error statusCode="503" path="../../errors/503.html" responseMode="ExecuteURL" />
          
          <!-- 504 Gateway Timeout -->
          <remove statusCode="504" subStatusCode="-1" />
          <error statusCode="504" path="../../errors/504.html" responseMode="ExecuteURL" />
        </httpErrors>
    </system.webServer>
</configuration>

